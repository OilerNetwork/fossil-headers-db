# Use rust:trixie which has a more recent Rust and better compatibility
FROM rust:slim-bookworm

WORKDIR /usr/app

# Install sqlx-cli with a compatible version
RUN cargo install sqlx-cli --version "=0.8.6" --no-default-features --features postgres

# Copy migrations and scripts
COPY migrations ./migrations
COPY build-scripts ./build-scripts

# Make scripts executable
RUN chmod +x ./build-scripts/run-migrations.sh

CMD ["./build-scripts/run-migrations.sh"]
